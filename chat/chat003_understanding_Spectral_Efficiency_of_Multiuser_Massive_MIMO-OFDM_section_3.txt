
â•­â”€â”€â”€ Claude Code v2.1.37 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                 â”‚ Tips for getting started   â”‚
â”‚           Welcome back Tech Shottify!           â”‚ Run /init to create a CLAâ€¦ â”‚
â”‚                                                 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                     â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ                     â”‚ Recent activity            â”‚
â”‚                    â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜                    â”‚ No recent activity         â”‚
â”‚                      â–˜â–˜ â–â–                      â”‚                            â”‚
â”‚                                                 â”‚                            â”‚
â”‚              Opus 4.6 Â· Claude Max              â”‚                            â”‚
â”‚   D:\Personal\Awesome-Wireless-Communications   â”‚                            â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â¯ Read @chat/chat002_understanding_system_model_pt1.txt this file. File is  
  large so you have to read it in chunks.                                   
  Give me a summary of it.                                                  
  Then read this file:                                                      
  D:\Personal\Awesome-Wireless-Communications\papers\Cellular\Spectral_Effi 
  ciency_of_Multiuser_Massive_MIMO-OFDM_THz_Wireless_Systems_with_Hybrid_Be 
  amforming_under_Inter-carrier_Interference.pdf                            
  --------------------------------                                          
  Specially this part:                                                      
  III.  PROBLEM FORMULATION AND SOLUTION APPROACH                           
  -----------------                                                         
  I want you to give me a very very detailed explanation of each line so    
  that I can have phd level knowledge on these topics.                      
  You will start explaining from the basic and in a easy way and then you   
  will enter into more complex topics and will give me in depth knowledge.  
  You will give me both theoretical and mathematical explanation. For       
  mathematical part, you will use conventional sign like exponential sign,  
  sum sign, suffix, prefix etc so that the writings look like its from a    
  book.                                                                     
  Do deep research and answer my questions.                                 
  âŽ¿ Â Read chat\chat002_understanding_system_model_pt1.txt (488 lines)

â— I already have the chat file content from the context. Let me now read the PDF
   paper's Section III.

â— Read 1 file (ctrl+o to expand)

â— Summary of Chat File (chat002)

  The previous session provided a PhD-level explanation of Section II: System 
  and Channel Models from Shaheed et al.'s paper. It covered:

  - System Model: Why the combination of multi-user + OFDM + massive MIMO + THz
  was chosen; the hybrid beamforming architecture (N_RF RF chains vs N_t
  antennas); single-antenna users with SDMA; OFDM parameter tradeoffs (K
  subcarriers, cyclic prefix overhead, ICI sensitivity)
  - THz Channel Model: Saleh-Valenzuela cluster-based model; the full channel
  equation H_q(f,d) with normalization factor âˆš(N_t/N_cÂ·N_ray), double summation
   over clusters/rays, complex channel gains Î±, array response vectors a(Ï†,Î¸),
  and antenna gains G_tÂ·G_r
  - Array Response Vector: UPA geometry derivation from first principles (phase
  shift from wave vector Â· position vector), why UPA over ULA for 3D THz
  beamforming
  - Path Loss Model: Friis spreading loss (c/4Ï€fd)Â² plus THz-specific molecular
  absorption e^(-k_absÂ·d) via Beer-Lambert law; why 0.3 THz is chosen
  (transmission window)

  ---
  Now, here is the deep explanation of Section III.

  ---
  Section III: PROBLEM FORMULATION AND SOLUTION APPROACH â€” PhD-Level Deep Dive

  I will build this from the ground up: first the conceptual foundation, then
  the mathematical formulation, then the optimization and algorithms.

  ---
  Part A: SINR Model and Problem Formulation

  1. The Matrix Definitions â€” Setting the Stage

  "Let H be the channel matrix, F be the digital beamforming matrix with size 
  N_RF Ã— U Ã— K, and W be the analog beamformer with size N_t Ã— N_RF."

  Why two separate matrices?

  This is the mathematical expression of hybrid beamforming. In a fully digital
  system, you would have a single precoding matrix. In a hybrid system, the
  precoding is factored into two stages:

  Signal flow:
  Data symbols s â†’ [Digital Precoder F] â†’ [RF Chains + DAC] â†’ [Analog Precoder
  W] â†’ Antennas â†’ Air

  The digital precoder F:
  - Size: N_RF Ã— U (per subcarrier, hence Ã— K total)
  - Operates in baseband (complex-valued, unconstrained in magnitude/phase)
  - One matrix per subcarrier k because digital processing happens before IDFT,
  so it can be frequency-selective
  - Maps U user data streams to N_RF RF chains

  The analog precoder W:
  - Size: N_t Ã— N_RF
  - Operates in RF domain using phase shifters
  - Shared across all subcarriers â€” this is critical! Analog phase shifters
  operate on the time-domain signal after the IDFT, so they cannot distinguish
  between subcarriers
  - Maps N_RF RF chain outputs to N_t antenna elements
  - Each element has constant modulus: |W_{m,n}| = 1/âˆšN_t (phase-only control)

  Why F is 3-dimensional (N_RF Ã— U Ã— K):
  - For each subcarrier k âˆˆ {1, ..., K}, there is a separate N_RF Ã— U digital 
  precoding matrix
  - This allows the digital precoder to adapt to frequency-selective channels
  - The analog precoder W cannot do this â€” it is a single matrix for all K
  subcarriers

  The combined precoder for user q on subcarrier k is:
  W Â· F_q[k]    âˆˆ  â„‚^(N_t Ã— 1)
  This is the effective beamforming vector that shapes the transmitted signal
  for user q on subcarrier k.

  ---
  2. The Received Signal Model (Equation 4)

  y[k] = Sâ‚€ H_q[k] W Fq[k] s_q[k] + Î”{q,k} + n[k]

  This is the most important equation in the paper. Let me derive it from 
  scratch.

  Background: What Happens in an OFDM System Without ICI

  In a perfect OFDM system, the received signal on subcarrier k for user q would
   be:

  y_ideal[k] = H_q[k] Â· W Â· F_q[k] Â· s_q[k]  +  Î£_{uâ‰ q} H_q[k] Â· W Â· F_u[k] Â·
  s_u[k]  +  n[k]
                 \_________________________/
  \________________________________________/     \___/
                   Desired signal                        Multi-user interference
   (MUI)           Noise

  The subcarriers are orthogonal â€” subcarrier k only sees channel H_q[k], and
  there is no leakage from other subcarriers. The only interference is from
  other users on the same subcarrier k.

  What Carrier Frequency Offset (CFO) Does

  In practice, the oscillators at BS and UE are never perfectly synchronized.
  There is a small frequency mismatch Î”f_CFO between them. This mismatch
  destroys the orthogonality between subcarriers.

  Physical mechanism:
  - OFDM relies on subcarriers being spaced exactly Î”f = B/K apart
  - The DFT/IDFT assumes each subcarrier is at frequency f_k = kÂ·Î”f
  - CFO shifts all subcarriers by Î”f_CFO
  - When the receiver performs the DFT to demodulate subcarrier k, it no longer
  perfectly isolates subcarrier k
  - Energy from subcarriers i â‰  k leaks into the k-th bin

  Mathematical derivation of ICI coefficients:

  The normalized CFO is defined as:
  Îµ = Î”f_CFO / Î”f
  where Î”f is the subcarrier spacing. The ICI coefficient from subcarrier i to 
  subcarrier k is:

  S_{i-k} = sin(Ï€(i - k + Îµ)) / (K Â· sin(Ï€(i - k + Îµ)/K)) Â· e^{jÏ€(i-k+Îµ)(K-1)/K}

  Key properties of S_{i-k}:
  - Sâ‚€ (when i = k): This is the useful signal coefficient. For small Îµ, |Sâ‚€| â‰ˆ
  1. For Îµ = 0 (no CFO), Sâ‚€ = 1 exactly.
  - S_{i-k} (when i â‰  k): These are the ICI coefficients. For Îµ = 0, all S_{i-k}
   = 0 (perfect orthogonality). For Îµ > 0, they are non-zero.
  - |Sâ‚€|Â² + Î£_{mâ‰ 0} |S_m|Â² = 1 (total power is conserved)

  The paper's ICI coefficient S in Table I (0.1 â‰¤ S â‰¤ 0.3) represents a
  simplified/parametric model of these coefficients, where a single value
  characterizes the severity of ICI.

  Now Let's Dissect Equation 4 Term by Term

  y[k] = Sâ‚€ Â· H_q[k] Â· W Â· F_q[k] Â· s_q[k]  +  Î”_{q,k}  +  n[k]

  Term 1: Sâ‚€ Â· H_q[k] Â· W Â· F_q[k] Â· s_q[k] â€” The Desired Signal

  - s_q[k] âˆˆ â„‚: The data symbol intended for user q on subcarrier k. Typically
  drawn from a constellation (QAM/PSK).
  - F_q[k] âˆˆ â„‚^(N_RF Ã— 1): The digital precoding vector for user q on subcarrier
   k. This is the q-th column of the digital precoding matrix F[k].
  - W âˆˆ â„‚^(N_t Ã— N_RF): The analog precoding matrix. Maps RF chain signals to
  antennas.
  - W Â· F_q[k] âˆˆ â„‚^(N_t Ã— 1): The combined beamforming vector. This is the
  actual spatial beam pattern directed toward user q.
  - H_q[k] âˆˆ â„‚^(1 Ã— N_t): The channel vector for user q on subcarrier k (row
  vector, since user has single antenna).
  - H_q[k] Â· W Â· F_q[k] âˆˆ â„‚: The effective scalar channel gain after
  beamforming. This is the "end-to-end" channel from BS to user q.
  - Sâ‚€: The ICI coefficient for the desired subcarrier (self-subcarrier).
  Represents the attenuation of the desired signal due to CFO. |Sâ‚€| < 1 when CFO
   exists, meaning some desired signal power is lost.

  Term 2: Î”_{q,k} â€” The Total Interference

  This is defined as:

  Î”_{q,k} = Î£_{u=1, uâ‰ q}^{U}  Î£_{i=0}^{K}  S_{i-k} Â· H_q[i] Â· W Â· F_u[i] Â·
  s_u[i]
           + Î£_{i=0, iâ‰ k}^{K}  S_{i-k} Â· H_q[i] Â· W Â· F_q[i] Â· s_q[i]

  This interference term has two distinct components. Understanding them is
  critical:

  Component 1: Inter-User Interference (IUI) with ICI
  Î£_{u=1, uâ‰ q}^{U}  Î£_{i=0}^{K}  S_{i-k} Â· H_q[i] Â· W Â· F_u[i] Â· s_u[i]
  - Outer sum: Over all other users u â‰  q
  - Inner sum: Over all subcarriers i = 0 to K
  - S_{i-k}: ICI coefficient from subcarrier i to subcarrier k
  - H_q[i] Â· W Â· F_u[i]: The effective channel from BS's beam for user u on
  subcarrier i, as seen by user q's channel on subcarrier i

  This means: User q's reception on subcarrier k is corrupted by transmissions
  intended for every other user u on every subcarrier i, weighted by the ICI
  coefficient S_{i-k}.

  Without ICI (Îµ = 0): S_{i-k} = 0 for i â‰  k, so only the i = k term survives,
  and this reduces to conventional multi-user interference on the same
  subcarrier.

  Component 2: Self-User ICI (Inter-Carrier Interference from user q's own
  signal)
  Î£_{i=0, iâ‰ k}^{K}  S_{i-k} Â· H_q[i] Â· W Â· F_q[i] Â· s_q[i]
  - Sum over all subcarriers i â‰  k (excluding the desired subcarrier)
  - This is user q's own signal on other subcarriers leaking into subcarrier k
  - Even without other users, CFO would cause this self-interference

  This is a subtle but important point: ICI creates interference from yourself.
  Your own symbols on neighboring subcarriers contaminate your desired 
  subcarrier.

  Term 3: n[k] â€” Noise
  - Additive White Gaussian Noise (AWGN)
  - n[k] ~ ð’žð’©(0, ÏƒÂ²_n): Complex Gaussian with variance ÏƒÂ²_n
  - Independent across subcarriers (whiteness property)

  ---
  3. The SINR Expression (Equation 5)

                      |Sâ‚€|Â² Â· |H_q[k] Â· W Â· F_q[k]|Â²
  SINR_{q,k} = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                        |Î”_{q,k}|Â²  +  Ïˆ

  where Ïˆ = KÏƒÂ²_n / P.

  Let me explain every aspect:

  Numerator: |Sâ‚€|Â² Â· |H_q[k] Â· W Â· F_q[k]|Â²
  - This is the desired signal power
  - |Sâ‚€|Â² < 1 when CFO exists â†’ the desired signal is attenuated
  - |H_q[k] Â· W Â· F_q[k]|Â² is the effective beamforming gain: how well the beam
  is pointed at user q
  - The goal of beamforming is to maximize this term for each user

  Denominator: |Î”_{q,k}|Â² + Ïˆ
  - |Î”_{q,k}|Â²: Total interference power (IUI + ICI combined)
  - Ïˆ = KÏƒÂ²_n / P: Normalized noise power

  Why Ïˆ = KÏƒÂ²_n / P and not just ÏƒÂ²_n?

  This comes from the power normalization. The total transmit power P is divided
   among K subcarriers and U users. The per-subcarrier, per-user power is
  P/(KU). When you normalize the SINR expression by dividing numerator and
  denominator by P/K, the noise term becomes KÏƒÂ²_n/P. This is equivalent to 
  1/SNR where SNR = P/(KÏƒÂ²_n).

  Physical interpretation of SINR_{q,k}:
  - High SINR â†’ user q can reliably decode subcarrier k â†’ high data rate
  - Low SINR â†’ user q cannot distinguish signal from interference+noise â†’ low
  data rate or errors
  - SINR depends on both the beamforming design (W, F) and the channel
  realization (H)

  ---
  4. Spectral Efficiency (Equations 6 and 7)

  Per-user, per-subcarrier spectral efficiency:
  Î³_{q,k} = logâ‚‚(1 + SINR_{q,k})    [bits/s/Hz]

  This is the Shannon capacity formula for a Gaussian channel. It represents the
   maximum achievable rate on subcarrier k for user q.

  Why logâ‚‚(1 + SINR)?
  - Derived from Shannon's channel capacity theorem
  - For a complex Gaussian channel with SNR = Ï, the capacity is logâ‚‚(1 + Ï) 
  bits per channel use
  - The "+1" accounts for the noise floor: even with zero signal (SINR = 0), the
   rate is logâ‚‚(1) = 0

  Total system spectral efficiency:
  SE = Î£_{q=1}^{U}  Î£_{k=1}^{K}  Î³_{q,k}    [bits/s/Hz]

  - Sum over all U users and all K subcarriers
  - This is the total throughput of the system normalized by bandwidth
  - This is what we want to maximize by choosing W and F properly

  The optimization problem (implicitly stated):
  max_{W, F}    SE = Î£_{q=1}^{U} Î£_{k=1}^{K} logâ‚‚(1 + SINR_{q,k})

  subject to:
      |W_{m,n}| = 1/âˆšN_t        (constant modulus for analog precoder)
      â€–W Â· F_u[k]â€–Â²_F = 1       (power constraint per user per subcarrier)

  Why this problem is hard:
  1. The objective function (sum of logâ‚‚(1+SINR)) is non-convex in W and F
  jointly
  2. The constant modulus constraint |W_{m,n}| = 1/âˆšN_t makes the feasible set a
   manifold, not a convex set
  3. W appears in both numerator and denominator of SINR â†’ fractional
  programming
  4. W is shared across all subcarriers but F is per-subcarrier â†’ coupling
  between subcarrier problems
  5. The ICI terms create coupling between all subcarriers in the SINR
  expression

  ---
  Part B: Low Complexity Hybrid Precoding Design

  5. The Key Insight: Minimize Interference Instead of Maximize Rate

  "To reduce the complexity and the optimization time of the system, the total
  interference for each user in each sub-carrier is minimized instead of
  maximizing the entire spectral efficiency R."

  Why this is a valid approximation:

  At high SINR:
  logâ‚‚(1 + SINR) â‰ˆ logâ‚‚(SINR) = logâ‚‚(Signal Power) âˆ’ logâ‚‚(Interference + Noise)

  Maximizing this is equivalent to maximizing signal power AND minimizing 
  interference. Since the analog precoder primarily controls beam direction 
  (which affects both signal and interference), and the digital precoder handles
   user separation, minimizing total interference with respect to W is a
  reasonable proxy.

  At moderate/low SINR, this approximation is less tight, which explains the
  small performance gap shown in Figure 2 of the paper.

  6. The Interference Expression (Equation 8)

  I_{q,k} = |Î”_{q,k}|Â²

         = Î£_{u=1, uâ‰ q}^{U}  Î£_{i=0}^{K}  |S_{i-k}|Â² Â· |H_q[i] Â· W Â· F_u[i]|Â²

           + Î£_{i=0, iâ‰ k}^{K}  |S_{i-k}|Â² Â· |H_q[i] Â· W Â· F_q[i]|Â²

  How did |Î”_{q,k}|Â² expand to this form?

  Starting from:
  Î”_{q,k} = Î£_{uâ‰ q} Î£_i S_{i-k} Â· H_q[i] Â· W Â· F_u[i] Â· s_u[i]  +  Î£_{iâ‰ k}
  S_{i-k} Â· H_q[i] Â· W Â· F_q[i] Â· s_q[i]

  Taking |Î”_{q,k}|Â² = E[|Î”_{q,k}|Â²] (expected interference power):
  - The symbols s_u[i] are independent across users and subcarriers
  - E[|s_u[i]|Â²] = 1 (unit power symbols after normalization)
  - Cross-terms vanish due to independence: E[s_u[i] Â· s*_v[j]] = 0 for (u,i) â‰ 
  (v,j)

  Therefore:
  E[|Î”_{q,k}|Â²] = Î£_{uâ‰ q} Î£_i |S_{i-k}|Â² Â· |H_q[i] Â· W Â· F_u[i]|Â² Â· E[|s_u[i]|Â²]
                  + Î£_{iâ‰ k} |S_{i-k}|Â² Â· |H_q[i] Â· W Â· F_q[i]|Â² Â· E[|s_q[i]|Â²]

  Since E[|s|Â²] = 1, we get Equation 8.

  Physical interpretation of each term in I_{q,k}:

  - |S_{i-k}|Â²: How much power leaks from subcarrier i to subcarrier k (ICI
  severity)
  - |H_q[i] Â· W Â· F_u[i]|Â²: How much the beam for user u on subcarrier i
  "illuminates" user q through the channel on subcarrier i

  First sum (IUI+ICI): Other users' beams on all subcarriers leaking into user
  q's subcarrier k
  Second sum (Self-ICI): User q's own beams on other subcarriers leaking into
  subcarrier k

  ---
  7. The Reformulated Optimization Problem (Equations 9â€“11)

  min_W    Î£_{q=1}^{U}  Î£_{k=1}^{K}  I_{q,k}        ... (9)

  subject to:
      |(w_n)_m| = 1/âˆšN_t,   1 â‰¤ n â‰¤ N_RF, 1 â‰¤ m â‰¤ N_t    ... (10)
      â€–W Â· F_u[k]â€–Â²_F = 1,  1 â‰¤ k â‰¤ K                     ... (11)

  Constraint (10) â€” Constant Modulus:

  Each element of W must have magnitude exactly 1/âˆšN_t. This is because:
  - Analog precoding is implemented with phase shifters
  - Phase shifters can only change the phase, not the amplitude
  - The 1/âˆšN_t normalizes so that the total array power is correct
  - Mathematically: W_{m,n} = (1/âˆšN_t) Â· e^{jÏ†_{m,n}} for some phase Ï†_{m,n}

  This constraint defines a complex circle manifold â€” each element lives on a
  circle of radius 1/âˆšN_t in the complex plane.

  Constraint (11) â€” Power Normalization:

  The combined precoder WÂ·F_u[k] must have unit Frobenius norm. This ensures:
  - Total transmit power per user per subcarrier is normalized to 1
  - Combined with the power P in the SINR formula, this gives the correct
  per-user power
  - Prevents the optimizer from "cheating" by increasing power

  Why this reformulation reduces complexity:

  The original problem maximizes Î£ logâ‚‚(1 + SINR_{q,k}), which:
  - Has SINR as a ratio (fractional)
  - The log makes the objective even more complex
  - Gradient computation requires chain rule through log, fraction, and matrix
  products

  The new problem minimizes Î£ I_{q,k}, which:
  - Is a sum of squared magnitudes (quadratic-like structure)
  - No log, no fraction
  - Gradients are much simpler to compute
  - The cost function is smoother and easier to optimize

  ---
  8. Digital Precoding: Zero-Forcing (Equations 12â€“13)

  The Concept of Effective Channel

  "The effective channel matrix, H_e for each sub-carrier k is computed as:
  H_e[k]^H = H[k]^H Â· W"

  H_e[k]^H = H[k]^H Â· W        ... (12)

  where:
  - H[k] âˆˆ â„‚^(U Ã— N_t): The physical channel matrix (all U users, N_t antennas,
  subcarrier k)
  - W âˆˆ â„‚^(N_t Ã— N_RF): The analog precoder
  - H_e[k] âˆˆ â„‚^(U Ã— N_RF): The effective channel seen by the digital precoder

  Why "effective channel"?

  The digital precoder F operates after the analog precoder W is fixed. From the
   digital precoder's perspective:
  - It only sees N_RF "virtual antennas" (the RF chain outputs)
  - The actual channel H combined with the analog precoder W forms an equivalent
   lower-dimensional channel H_e
  - The digital precoder designs F based on H_e, not H

  This is the key to the alternating optimization approach: fix W, design F for
  the effective channel, then improve W.

  Zero-Forcing Precoder

  F_u[k] = (H_e[k] Â· H_e[k]^H)^{-1} Â· H_e[k]        ... (13)

  What Zero-Forcing does:

  ZF precoding eliminates multi-user interference completely (on the same
  subcarrier). It designs F such that:
  H_e[k]^H Â· F_u[k] = { 1  if output corresponds to user u
                       { 0  if output corresponds to any other user

  Derivation:

  The received signal (ignoring ICI) for all users on subcarrier k:
  y[k] = H_e[k]^H Â· F[k] Â· s[k] + n[k]

  We want H_e[k]^H Â· F[k] = I_U (identity matrix). The solution is the
  pseudo-inverse:
  F[k] = H_e[k] Â· (H_e[k]^H Â· H_e[k])^{-1}     (right pseudo-inverse)

  The paper writes it as (H_e Â· H_e^H)^{-1} Â· H_e, which is the left
  pseudo-inverse form, applicable when H_e has dimensions such that this is the
  Moore-Penrose pseudo-inverse.

  When does ZF work well?
  - When N_RF â‰¥ U (more RF chains than users) â€” necessary for the inverse to
  exist
  - When channels of different users are sufficiently different
  (well-conditioned H_e)
  - In massive MIMO: channels tend to be nearly orthogonal, so ZF works very
  well

  When does ZF fail?
  - When channels are correlated (ill-conditioned H_e Â· H_e^H)
  - ZF can amplify noise in this case (noise enhancement problem)
  - Regularized ZF (MMSE) addresses this but adds complexity

  Power Normalization

  "F_u[k] = F_u[k] / â€–W Â· F_u[k]â€–Â²_F"

  After computing the ZF precoder, the combined precoder WÂ·F_u[k] may not
  satisfy the power constraint â€–WÂ·F_u[k]â€–Â²_F = 1. This normalization step scales
   each user's precoder to satisfy constraint (11).

  ---
  9. Analog Precoding: Riemannian Manifold Optimization

  This is the most mathematically sophisticated part of the paper.

  Why Not Standard Gradient Descent?

  The constant modulus constraint |W_{m,n}| = 1/âˆšN_t means the feasible set is
  not a convex set in Euclidean space. Standard gradient descent would:
  1. Compute a gradient in unconstrained space
  2. Take a step
  3. The new point would violate |W_{m,n}| = 1/âˆšN_t
  4. You'd need to project back onto the constraint set

  Instead, Riemannian optimization works directly on the constraint surface
  (manifold), so every iterate automatically satisfies the constraints.

  The Manifold (Equation 14)

  M = { x âˆˆ â„‚^{N_tÂ·U} : |x_i| = 1/âˆšN_t,  i = 1, 2, ..., N_tÂ·U }

  where x = vec(W) (W reshaped into a vector).

  What is this manifold geometrically?

  Each element x_i lives on a circle of radius 1/âˆšN_t in the complex plane. The 
  full manifold M is a product of circles â€” a torus in high dimensions.
  Formally:
  M = SÂ¹(1/âˆšN_t) Ã— SÂ¹(1/âˆšN_t) Ã— ... Ã— SÂ¹(1/âˆšN_t)    (N_tÂ·N_RF times)

  where SÂ¹(r) is a circle of radius r.

  This is a smooth manifold of dimension N_tÂ·N_RF (one angular degree of freedom
   per element, since the magnitude is fixed).

  Tangent Space

  The tangent space Ï„_x M at point x is the set of vectors tangent to M at x.
  For a product-of-circles manifold, the tangent vector at x_i must be
  perpendicular to x_i (in the complex plane):
  Ï„_x M = { z âˆˆ â„‚^{N_tÂ·U} : Re(z_i Â· x_i*) = 0,  âˆ€i }

  Each tangent component z_i is perpendicular to x_i, meaning it represents a 
  change in phase only (no change in magnitude).

  Retraction (Equation 15)

  R(x) = (1/âˆšN_t) Â· vec[ xâ‚/|xâ‚|, xâ‚‚/|xâ‚‚|, ..., x_{N_tÂ·U}/|x_{N_tÂ·U}| ]

  After taking a step in the tangent space (which may leave the manifold
  slightly), the retraction maps the point back onto the manifold by:
  1. Normalizing each element to have magnitude 1/âˆšN_t
  2. Preserving the phase of each element

  This is the simplest and most computationally efficient retraction for a
  product-of-circles manifold.

  The Cost Function (Equation 16)

  f(x) = R_sum = Î£_{q=1}^{U} Î£_{k=1}^{K} I_{q,k}

  This is the total system interference â€” exactly what we want to minimize.

  Algorithm 1: Conjugate Gradient on the Manifold

  This is a Riemannian conjugate gradient (RCG) algorithm. Let me explain each
  step:

  Step 1: Input â€” F[k] for all k (fixed digital precoders), initial point xâ‚€, 
  step size Î±, threshold Îµâ‚

  Step 2: Initial direction
  dâ‚€ = T_{xâ‚€}( df(x)/dx |_{x=xâ‚€} )
  - Compute the Euclidean gradient df/dx at xâ‚€
  - Project it onto the tangent space at xâ‚€ using T_{xâ‚€}(Â·)
  - This gives the steepest descent direction on the manifold

  Step 3: While loop â€” Continue until the cost function stops decreasing
  (convergence)

  Step 4: Update position â€” x_{t+1} = x_t + Î±Â·d_t (step in direction d_t)

  Step 5: Retract â€” x_{t+1} = R(x_{t+1}) (map back onto manifold)

  Step 6: Riemannian gradient â€” Compute gradient and project onto tangent space
  at new point

  Step 7: Polak-RibiÃ¨re parameter Î²_{t+1}:
  Î²_{t+1} = g^H_{t+1} Â· (g_{t+1} âˆ’ T_{x_{t+1}}(g_t)) / â€–T_{x_{t+1}}(g_t)â€–Â²_F
  This is the Polak-RibiÃ¨re formula adapted for manifolds. It determines how
  much of the previous search direction to retain. The vector transport
  T_{x_{t+1}}(g_t) moves the previous gradient g_t from the old tangent space to
   the new tangent space (they are different spaces on a curved manifold).

  Why conjugate gradient instead of steepest descent?
  - Steepest descent has slow convergence (zig-zagging near the optimum)
  - Conjugate gradient uses information from previous directions to avoid this
  - Converges much faster for quadratic-like cost functions
  - Î² controls the "memory" of previous directions

  Step 8: Conjugate direction:
  d_{t+1} = g_{t+1} + Î²_{t+1} Â· T_{x_{t+1}}(d_t)
  The new search direction is the current gradient plus a fraction of the 
  transported previous direction.

  ---
  10. Algorithm 2: The Full Hybrid Precoding Pipeline

  This is an alternating optimization algorithm:

  1. Initialize W randomly (uniform phase distribution)
  2. Repeat:
     a. Fix W â†’ compute effective channel H_e = H^H Â· W
     b. Compute ZF digital precoder F using H_e
     c. Fix F â†’ optimize analog precoder W using Algorithm 1 (manifold
  optimization)
     d. Compute total interference R_sum
  3. Until R_sum converges (change < Îµ)

  Why alternating optimization works:
  - Joint optimization over (W, F) is extremely difficult
  - Fixing one and optimizing the other is much easier
  - Each sub-problem has good structure: ZF has a closed-form solution; manifold
   optimization is well-behaved
  - Alternating optimization converges to a local optimum (not necessarily
  global, but good in practice)

  Convergence guarantee:
  - Each step (digital or analog) reduces or maintains the cost
  - R_sum is bounded below by 0
  - A monotonically decreasing bounded sequence converges
  - The algorithm is guaranteed to converge to a stationary point

  ---
  11. Computational Complexity Comparison

  Conventional approach: Optimize the full SE = Î£ logâ‚‚(1 + SINR_{q,k})
  - Gradient of logâ‚‚(1 + SINR) involves: chain rule through log, quotient rule
  for SINR (ratio), and matrix calculus
  - Each gradient evaluation requires computing SINR for all users and
  subcarriers
  - The log and fraction create a highly nonlinear landscape

  Proposed approach: Minimize Î£ I_{q,k}
  - Gradient of I_{q,k} is a quadratic form in W
  - Much simpler computation: derivatives of |HÂ·WÂ·F|Â² are straightforward matrix
   products
  - No log, no fraction â†’ smoother optimization landscape
  - Result from Table II: 13Ã— speedup (986.9 vs 74.0 seconds)

  The tradeoff (visible in Figure 2): The proposed method achieves slightly
  lower spectral efficiency than the conventional method, because minimizing
  interference is not exactly equivalent to maximizing rate. But the gap is
  small, making the 13Ã— speedup worthwhile.

  ---
  Summary Table of Section III
  Component: Received signal
  Equation: y[k] = Sâ‚€Â·H_qÂ·WÂ·F_qÂ·s_q + Î” + n
  Purpose: Models desired signal + all interference + noise
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Interference Î”_{q,k}
  Equation: Two double sums with S_{i-k}
  Purpose: IUI + ICI combined (the paper's novelty)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: SINR
  Equation: Signal power / (Interference + Noise)
  Purpose: Quality metric per user per subcarrier
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Spectral efficiency
  Equation: SE = Î£Î£ logâ‚‚(1 + SINR)
  Purpose: What we ultimately want to maximize
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Reformulated problem
  Equation: min Î£ I_{q,k}
  Purpose: Simpler proxy: minimize interference
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Digital precoder (ZF)
  Equation: F = (H_eÂ·H_e^H)^{-1}Â·H_e
  Purpose: Eliminates multi-user interference on same subcarrier
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Analog precoder (MO)
  Equation: Conjugate gradient on manifold
  Purpose: Finds optimal phases under constant-modulus constraint
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Component: Hybrid algorithm
  Equation: Alternating Wâ†”F optimization
  Purpose: Iterates until convergence
  The paper's core contribution is extending the ICI-aware hybrid beamforming
  framework from single-user (prior work [3],[4]) to multi-user, which
  introduces the IUI+ICI coupling in Î”_{q,k}, and providing a computationally
  efficient reformulation that avoids optimizing through the log-SINR
  expression.

âœ» Crunched for 3m 3s